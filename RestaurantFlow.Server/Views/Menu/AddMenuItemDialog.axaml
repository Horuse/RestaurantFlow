<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:RestaurantFlow.Server.ViewModels.Menu"
             mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="700"
             x:Class="RestaurantFlow.Server.Views.Menu.AddMenuItemDialog"
             x:DataType="vm:AddMenuItemViewModel">

    <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="600">
        <StackPanel Spacing="24" Margin="24">
            <StackPanel Spacing="8">
                <TextBlock Text="{Binding Title}" FontSize="18" FontWeight="Bold" />
                <TextBlock Text="Заповніть дані страви" FontSize="12" Foreground="#666666" />
            </StackPanel>

            <StackPanel Spacing="16">
            <Grid ColumnDefinitions="* *" ColumnSpacing="16">
                <StackPanel Grid.Column="0" Spacing="8">
                    <TextBlock Text="Назва страви" FontSize="12" />
                    <TextBox Text="{Binding Name, Mode=TwoWay}"
                            Watermark="Назва страви..."/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Spacing="8">
                    <TextBlock Text="Категорія" FontSize="12" />
                    <ComboBox ItemsSource="{Binding Categories}"
                             SelectedItem="{Binding SelectedCategory, Mode=TwoWay}"
                             DisplayMemberBinding="{Binding Name}"
                             PlaceholderText="Оберіть категорію..."/>
                </StackPanel>
            </Grid>

          
            <StackPanel Spacing="8">
                <TextBlock Text="Опис страви" FontSize="12" />
                <TextBox Text="{Binding Description, Mode=TwoWay}"
                        Watermark="Опис страви..."
                        Height="80"
                        AcceptsReturn="True"
                        TextWrapping="Wrap"/>
            </StackPanel>


            <StackPanel Spacing="8">
                <TextBlock Text="Зображення страви" FontSize="12" />
                
                    <StackPanel Spacing="12">
                        <StackPanel Spacing="8" VerticalAlignment="Center"
                                   IsVisible="{Binding ImageData, Converter={x:Static ObjectConverters.IsNull}}">
                            <TextBlock Text="Зображення не обрано" FontSize="12" 
                                      Foreground="#666666" HorizontalAlignment="Center" />
                        </StackPanel>
                        
                        <StackPanel Spacing="4" VerticalAlignment="Center"
                                   IsVisible="{Binding ImageData, Converter={x:Static ObjectConverters.IsNotNull}}">
                            <TextBlock Text="✓" FontSize="24" HorizontalAlignment="Center" 
                                      Foreground="Green" />
                            <TextBlock Text="{Binding ImagePath}" FontSize="10" 
                                      Foreground="#666666" HorizontalAlignment="Center"
                                      TextTrimming="CharacterEllipsis" MaxWidth="200" />
                        </StackPanel>
                        
                        <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                            <Button Classes="Secondary" Content="Обрати зображення" 
                                   Command="{Binding SelectImageCommand}" />
                            <Button Classes="Secondary" Content="Видалити" 
                                   Command="{Binding RemoveImageCommand}"
                                   IsVisible="{Binding ImageData, Converter={x:Static ObjectConverters.IsNotNull}}" />
                        </StackPanel>
                    </StackPanel>
            </StackPanel>


            <Grid ColumnDefinitions="* *" ColumnSpacing="16">
                <StackPanel Grid.Column="0" Spacing="8">
                    <TextBlock Text="Ціна (грн)" FontSize="12" />
                    <NumericUpDown Value="{Binding Price, Mode=TwoWay}"
                                  Minimum="0.01"
                                  Maximum="10000"
                                  Increment="0.50"
                                  FormatString="F2"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Spacing="8">
                    <TextBlock Text="Час приготування (хвилин)" FontSize="12" />
                    <NumericUpDown Value="{Binding EstimatedCookingTimeMinutes, Mode=TwoWay}"
                                  Minimum="1"
                                  Maximum="120"
                                  Increment="1"/>
                </StackPanel>
            </Grid>
            
            <Grid ColumnDefinitions="* *" ColumnSpacing="16">
                <StackPanel Grid.Column="0" Spacing="8">
                    <TextBlock Text="Калорії" FontSize="12" />
                    <NumericUpDown Value="{Binding Calories, Mode=TwoWay}"
                                  Minimum="0"
                                  Maximum="5000"
                                  Increment="10"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Spacing="8">
                    <TextBlock Text="Алергени" FontSize="12" />
                    <TextBox Text="{Binding Allergens, Mode=TwoWay}"
                            Watermark="Через кому..."/>
                </StackPanel>
            </Grid>
            
            <StackPanel Spacing="8">
                <TextBlock Text="Інгредієнти" FontSize="12" />
                <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding AvailableIngredients}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="8" Margin="0,2">
                                    <Grid ColumnDefinitions="Auto,*,150,Auto">
                                        <CheckBox Grid.Column="0" 
                                                 IsChecked="{Binding IsSelected, Mode=TwoWay}" />
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding Name}" 
                                                  VerticalAlignment="Center" 
                                                  Margin="8,0,0,0" />
                                        <NumericUpDown Grid.Column="2"
                                                      Value="{Binding Quantity, Mode=TwoWay}"
                                                      Minimum="0"
                                                      Maximum="1000"
                                                      Increment="0.1"
                                                      FormatString="F2"
                                                      IsEnabled="{Binding IsSelected}"
                                                      Margin="8,0" />
                                        <TextBlock Grid.Column="3" 
                                                  Text="{Binding Unit}" 
                                                  VerticalAlignment="Center" 
                                                  FontSize="10" 
                                                  Foreground="#666666" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </StackPanel>

            <StackPanel Spacing="12">
                <CheckBox Content="Доступна для замовлення" 
                         IsChecked="{Binding IsAvailable, Mode=TwoWay}"/>
            </StackPanel>
        </StackPanel>
        
        <Grid ColumnDefinitions="* Auto Auto" ColumnSpacing="12">
            <ProgressBar Grid.Column="0" 
                        IsIndeterminate="True" 
                        IsVisible="{Binding IsBusy}"
                        Height="4"
                        VerticalAlignment="Center" />

            <Button Classes="Destructive" Grid.Column="1" 
                   Content="Скасувати"
                   Command="{Binding CancelCommand}"
                   Width="100" />

            <Button Classes="Primary" Grid.Column="2" 
                   Content="{Binding SubmitText}"
                   Command="{Binding SubmitCommand}"
                   IsEnabled="{Binding !IsBusy}"
                   Width="100" />
            </Grid>
            </StackPanel>
    </ScrollViewer>
</UserControl>